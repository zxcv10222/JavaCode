<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 회원정보 처리 SQL -->
<mapper namespace="tech.jjs.javacode.board.mapper.IBoardMapper">

	<!-- 개시글 등록 -->
	<insert id="insert" parameterType="Board">
		insert into JAVACODE_BOARD
		(
		boardnum
		,title
		,content
		,tag
		<if test="originalfile !=null and savedfile !=null">
			,originalfile
			,savedfile
		</if>
		,insertdate
		,id
		,url
		,category
		)
		values
		(
		SEQ_JAVACODE_BOARD.nextval
		,#{title}
		,#{content}
		,#{tag}
		<if test="originalfile != null and savedfile !=null">
			,#{originalfile}
			,#{savedfile}
		</if>
		,sysdate
		,#{id}
		,#{url}	
		,#{category}
		)
	</insert>



	<!-- 게시글 읽기 -->
	<select id="read" parameterType="int" resultType="Board">
		select
		boardnum
		,title
		,content
		,tag
		,originalfile
		,savedfile
		,to_char(insertDate,'yyyy-mm-dd hh:mi') insertdate
		,id
		,url
		,category
		from JAVACODE_BOARD where boardnum = #{boardnum}
	</select>


	<!-- 현재 페이지 목록(검색 필터링 후) -->
	<select id="list" parameterType="hashmap" resultType="Board">
		select
		boardnum
		,title
		,to_char(insertDate,'yyyy-mm-dd')
		insertdate
		
		,id
		from
		JAVACODE_BOARD
		<if test="type =='title' and searchText !=null">
			where
			title like '%' || #{searchText} || '%'
		</if>
		<if test="type =='titleContent' and searchText !=null">
			where
			title like '%' || #{searchText} || '%'
			or content like
			'%' || #{searchText} || '%'
		</if>
		<if test="type =='id' and searchText !=null">
			where
			id like '%' || #{searchText} || '%'
		</if>
		order by boardnum desc
	</select>


	<!-- 전체 글 수 -->
	<select id="getTotal" parameterType="hashmap" resultType="int">
		select count(*) from JAVACODE_BOARD
		<where>
			<if test="searchText!=null">
				<if test="type =='title' ">
					title like '%' || #{searchText} || '%'
				</if>
				<if test="type =='titleContent' ">
					title like '%' || #{searchText} || '%'
					or content like
					'%' || #{searchText} || '%'
				</if>
				<if test="type =='id' ">
					id like '%' || #{searchText} || '%'
				</if>
			</if>
		</where>
		order by boardnum desc
	</select>

	<!-- 글 삭제 -->
	<delete id="delete" parameterType="int">
		delete from JAVACODE_BOARD where
		boardnum = #{boardnum}
	</delete>


	<!-- 글 수정 -->
	<update id="edit" parameterType="Board">
		update JAVACODE_BOARD set
		title = #{title}
		, content =#{content}
		<if test="originalfile !=null and savedfile !=null">
			, originalfile = #{originalfile}
			, savedfile = #{savedfile}
		</if>
		where
		boardnum = #{boardnum}
	</update>


</mapper>
